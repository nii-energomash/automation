# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Resolve tag from ref
description: Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ git-Ñ‚ÐµÐ³Ð° Ð¸Ð· Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð½Ð¾Ð³Ð¾ git-ref (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ñ‚ÐµÐ³Ñƒ)

inputs:
  ref:
    required: false
    description: Git-ref (ÐµÑÐ»Ð¸ Ð½Ðµ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ github.ref)

outputs:
  tag:
    value: ${{ steps.resolve.outputs.tag }}
    description: Resolved git-tag

runs:
  using: composite
  steps:
    - name: ðŸ·ï¸ Resolve tag from ref
      id: resolve
      shell: bash
      run: |
        set -euo pipefail

        REF="${{ inputs.ref != '' && inputs.ref || github.ref }}"

        if [ -z "${REF}" ]; then
          echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ref Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½"
          exit 1
        fi

        TAG="${REF#refs/tags/}"

        if [ "${TAG}" = "${REF}" ]; then
          echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð¿ÐµÑ€ÐµÐ´Ð°Ð½Ð½Ñ‹Ð¹ ref '${REF}' Ð½Ðµ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° git-Ñ‚ÐµÐ³"
          exit 1
        fi

        echo "tag=$TAG" >> "$GITHUB_OUTPUT"
        echo "ðŸ“Œ Ð¢ÐµÐ³ Ð¸Ð· ref: ${TAG}"
