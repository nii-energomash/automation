# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Validate ref on master
description: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°, Ñ‡Ñ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ git-ref Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ Ğ² master-Ğ²ĞµÑ‚ĞºĞµ

inputs:
  ref:
    required: true
    description: git-ref (commit hash, branch, tag)

runs:
  using: composite
  steps:
    - name: ğŸ” Validate ref on master
      shell: bash
      run: |
        set -euo pipefail

        REF="${{ inputs.ref }}"
        echo "ğŸ” Checking ref: $REF"

        if ! REF_COMMIT="$(git rev-parse "$REF" 2>/dev/null)"; then
          echo "âŒ Invalid ref: $REF"
          exit 1
        fi

        echo "ğŸ“ Ref commit: $REF_COMMIT"

        git fetch --no-tags origin master

        if git merge-base --is-ancestor "$REF_COMMIT" origin/master; then
          echo "âœ… Ref $REF is on master"
        else
          echo "âŒ Ref $REF is NOT on master"
          exit 1
        fi
