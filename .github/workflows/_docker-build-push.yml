# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Reusable Docker build & push
description: >
    –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π workflow, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π —Å–±–æ—Ä–∫—É –∏ push docker-–æ–±—Ä–∞–∑–∞

on:
  workflow_call:
    inputs:
      tags:
        required: true
        type: string
        description: |
          –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ docker (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è registry/image),
          –Ω–∞–ø—Ä–∏–º–µ—Ä:
            sha-abcdef
            1.2.3
            latest
      ref:
        required: false
        type: string
        description: Git-ref
      registry:
        required: false
        type: string
        default: 'ghcr.io'
        description: –†–µ–≥–∏—Å—Ç—Ä –æ–±—Ä–∞–∑–æ–≤
      image-name:
        required: false
        type: string
        default: ''
        description: –ò–º—è –æ–±—Ä–∞–∑–∞
    secrets:
      registry-token:
        required: true
      package-token:
        required: true

jobs:
  reusable-build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: üõí Checkout
        uses: actions/checkout@v5
        with:
          ref: ${{ inputs.ref || github.ref }}

      - name: üîê Log in to container registry (${{ inputs.registry }})
        uses: docker/login-action@v3
        with:
          registry: ${{ inputs.registry }}
          username: ${{ github.actor }}
          password: ${{ secrets.registry-token }}

      - name: üê≥ Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ${{ inputs.tags }}
          secrets: |
            PACKAGES_TOKEN=${{ secrets.package-token }}
